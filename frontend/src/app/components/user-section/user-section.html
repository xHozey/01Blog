<div class="user-section p-4 rounded bg-white custom-shadow">
  <h6 class="sidebar-title">Suggested Users</h6>

  <div class="scroll-wrapper">
    <ul class="list-unstyled m-0 scroll-container" infiniteScroll [infiniteScrollDistance]="0.5"
      [infiniteScrollThrottle]="200" (scrolled)="loadMore()" [scrollWindow]="false">
      @for (suggestion of users; track suggestion.userResponse.id) {
      <li class="user-item d-flex align-items-center justify-content-between mb-2">
        <div class="d-flex align-items-center gap-3">
          <img [src]="suggestion.userResponse.iconPath || 'assets/default-avatar.png'" 
               alt="{{ suggestion.userResponse.username }}'s avatar" 
               class="rounded-circle avatar" 
               width="48" height="48"
               loading="lazy">
          <div class="user-info">
            <div (click)="goToProfile(suggestion.userResponse.id)" 
                 class="fw-semibold clickable username"
                 [attr.aria-label]="'View profile of ' + suggestion.userResponse.username">
              {{ suggestion.userResponse.username }}
            </div>
            <small class="text-muted bio" style="word-break: break-all;">{{ suggestion.userResponse.bio | slice:0:40 }}...</small>
          </div>
        </div>

        <button (click)="onFollow(suggestion.userResponse.id)" 
                class="btn btn-sm rounded-pill px-3 follow-btn"
                [ngClass]="suggestion.isFollowing ? 'btn-outline-secondary' : 'btn-primary'"
                [attr.aria-label]="suggestion.isFollowing ? 'Unfollow ' + suggestion.userResponse.username : 'Follow ' + suggestion.userResponse.username">
          {{ suggestion.isFollowing ? 'Following' : 'Follow' }}
        </button>
      </li>
      }
    </ul>

    <div class="status-container">
      @if (isLoading) {
        <div class="text-center py-3 text-secondary loading-state">
          <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
          Loading more users...
        </div>
      }
      @if (allLoaded && users.length === 0) {
        <div class="text-center py-3 text-secondary empty-state">
          No suggestions available.
        </div>
      }
    </div>
  </div>
</div>