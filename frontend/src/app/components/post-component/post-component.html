<article class="post-container">

  <header class="post-header">
    <div class="author-info">
      <img [src]="post.authorAvatar" alt="User Avatar" class="post-avatar" />
      <span class="author-name ms-2" (click)="goToProfile()">{{ post.author }}</span>
      <span class="post-time">Â· {{ post.createdAt | date: 'MMM d' }}</span>
    </div>

    <div class="dropdown">
      <button class="btn btn-link p-0" id="postMenuBtn" data-bs-toggle="dropdown" aria-expanded="false"
        style="color: var(--nav-link-color);">
        <lucide-icon [img]="EllipsisIcon" size="18"></lucide-icon>
      </button>
      <ul class="dropdown-menu dropdown-menu-end shadow-sm">
        @if (user?.id === post.authorId) {
        <li><button class="dropdown-item" (click)="update.emit(post.id)">
            <i class="fa fa-edit me-2"></i>Edit Post
          </button></li>
        <li>
          <hr class="dropdown-divider">
        </li>
        }
        @if (user?.id === post.authorId || user?.roles?.includes('ADMIN')) {
        <li><button class="dropdown-item text-danger" (click)="delete.emit(post.id)">
            <i class="fa fa-trash me-2"></i>Delete
          </button></li>
        }
        @if (user?.roles?.includes('ADMIN')) {
        @if (!(user?.id === post.authorId)) { <li>
          <hr class="dropdown-divider">
        </li> }
        <li><button class="dropdown-item" (click)="hide.emit(post.id)">
            <i class="fa fa-eye-slash me-2"></i>Hide
          </button></li>
        }
        <li>
          <hr class="dropdown-divider">
        </li>
        <li><button class="dropdown-item" (click)="report.emit(post.authorId)">
            <i class="fa fa-flag me-2"></i>Report
          </button></li>
      </ul>
    </div>
  </header>

  <h2 class="post-title" (click)="goToPost()">{{ post.title }}</h2>

  <div class="post-actions">
    <button (click)="toggleLike()" [ngClass]="liked ? 'liked' : ''" class="action-btn like-btn">
      <lucide-icon [img]="HeartIcon" size="16"></lucide-icon>
      <span>{{ post.likes }}</span>
    </button>

    <button (click)="toggleComments()" [class.active]="showComments" class="action-btn comment-btn">
      <i class="fa fa-comment"></i>
      <span>{{ showComments ? 'Hide' : 'Comments' }}</span>
    </button>
  </div>

  @if (showComments) {
  <div class="comments-section">
    <app-comment-section [postId]="post.id"></app-comment-section>
  </div>
  }

</article>