<app-navbar-component />

<div class="container my-4">
  <!-- Dashboard Summary -->
  <div class="row g-3 mb-4">
    @for (card of [
    { title: 'Total Users', value: totalUsers, icon: 'bi-people', color: 'success' },
    { title: 'User Reports', value: totalUserReports, icon: 'bi-flag', color: 'warning' },
    { title: 'Total Posts', value: totalPosts, icon: 'bi-file-earmark-text', color: 'primary' }
    ]; track card.title) {
    <div class="col-md-4">
      <div class="card shadow-sm border-light h-100">
        <div class="card-body">
          <h6 class="text-muted d-flex align-items-center">
            <i class="bi {{ card.icon }} me-2 text-{{ card.color }}"></i> {{ card.title }}
          </h6>
          <h3 class="fw-bold">{{ card.value }}</h3>
        </div>
      </div>
    </div>
    }
  </div>

  <!-- Tabs -->
  <ul class="nav nav-tabs mb-3">
    <li class="nav-item">
      <button class="nav-link" [ngClass]="{ active: activeTab === 'users' }" (click)="setTab('users')">Users</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" [ngClass]="{ active: activeTab === 'userReports' }" (click)="setTab('userReports')">
        User Reports
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" [ngClass]="{ active: activeTab === 'posts' }" (click)="setTab('posts')">Posts</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" [ngClass]="{ active: activeTab === 'postReports' }" (click)="setTab('postReports')">Post
        Reports</button>
    </li>
  </ul>

  <!-- Loading -->
  @if (isLoading) {
  <div class="text-center my-4">
    <div class="spinner-border text-primary" role="status"></div>
  </div>
  }

  <!-- USERS TAB -->
  @if (!isLoading && activeTab === 'users') {
  <div class="card shadow-sm border-light">
    <div class="card-body">
      <h5 class="mb-3">User Management</h5>
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>Avatar</th>
            <th>Username</th>
            <th>Email</th>
            <th>Status</th>
            <th>Joined</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (user of users; track user.id) {
          <tr>
            <td><img [src]="user.iconPath || 'assets/default-avatar.png'" width="40" height="40"
                class="rounded-circle" /></td>
            <td><strong>@{{ user.username }}</strong></td>
            <td>{{ user.email }}</td>
            <td><span class="badge" [ngClass]="user.isBanned ? 'bg-danger' : 'bg-success'">{{ user.isBanned ? 'Banned' :
                'Active' }}</span></td>
            <td>{{ user.createdAt | date }}</td>
            <td>
              <button class="btn btn-sm btn-outline-warning me-2" (click)="toggleBan(user)">
                {{ user.isBanned ? 'Unban' : 'Ban' }}
              </button>
              <button class="btn btn-sm btn-outline-danger" (click)="deleteUser(user)">Delete</button>
            </td>
          </tr>
          }
        </tbody>
      </table>

      <div class="d-flex justify-content-between align-items-center">
        <button class="btn btn-outline-primary btn-sm" (click)="prevUsersPage()"
          [disabled]="pageUsers === 0">Previous</button>
        <span>Page {{ pageUsers + 1 }}</span>
        <button class="btn btn-outline-primary btn-sm" (click)="nextUsersPage()"
          [disabled]="!hasMoreUsers">Next</button>
      </div>
    </div>
  </div>
  }

  <!-- REPORTS TAB -->
  @if (!isLoading && activeTab === 'userReports') {
  <div class="card shadow-sm border-light">
    <div class="card-body">
      <h5 class="mb-3">User Reports</h5>
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>Reporter</th>
            <th>Reported</th>
            <th>Description</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (report of userReports; track report.id) {
          <tr>
            <td>@{{ report.reporterName }}</td>
            <td>@{{ report.reportedName }}</td>
            <td>{{ report.description }}</td>
            <td>{{ report.createAt| date }}</td>
            <td>
              <button class="btn btn-sm btn-outline-danger" (click)="deleteReport(report)">Delete Report</button>
            </td>
          </tr>
          }
        </tbody>
      </table>

      <div class="d-flex justify-content-between align-items-center">
        <button class="btn btn-outline-primary btn-sm" (click)="prevUserReportsPage()"
          [disabled]="userReportsPage === 0">Previous</button>
        <span>Page {{ userReportsPage + 1 }}</span>
        <button class="btn btn-outline-primary btn-sm" (click)="nextUserReportsPage()"
          [disabled]="!hasMoreUserReports">Next</button>
      </div>
    </div>
  </div>
  }

  <!-- POSTS TAB -->
  @if (!isLoading && activeTab === 'posts') {
  <div class="card shadow-sm border-light">
    <div class="card-body">
      <h5 class="mb-3">Posts</h5>
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>Title</th>
            <th>Author</th>
            <th>Likes</th>
            <th>Created</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (post of posts; track post.id) {
          <tr>
            <td>{{ post.title }}</td>
            <td>@{{ post.authorName }}</td>
            <td>{{ post.likes }}</td>
            <td>{{ post.createdAt | date }}</td>
            <td><span class="badge" [ngClass]="post.isHide ? 'bg-secondary' : 'bg-success'">{{ post.isHide ? 'Hidden' :
                'Visible' }}</span></td>
            <td>
              <button class="btn btn-sm btn-outline-secondary me-2" (click)="hidePost(post)">
                {{ post.isHide ? 'Unhide' : 'Hide' }}
              </button>
              <button class="btn btn-sm btn-outline-danger" (click)="deletePost(post)">Delete</button>
            </td>
          </tr>
          }
        </tbody>
      </table>

      <div class="d-flex justify-content-between align-items-center">
        <button class="btn btn-outline-primary btn-sm" (click)="prevPostsPage()"
          [disabled]="pagePosts === 0">Previous</button>
        <span>Page {{ pagePosts + 1 }}</span>
        <button class="btn btn-outline-primary btn-sm" (click)="nextPostsPage()"
          [disabled]="!hasMorePosts">Next</button>
      </div>
    </div>
  </div>
  }

  @if (!isLoading && activeTab === 'postReports') {
  <div class="card shadow-sm border-light">
    <div class="card-body">
      <h5 class="mb-3">Post Reports</h5>
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>Reporter</th>
            <th>Reported</th>
            <th>Description</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (report of postReports; track report.id) {
          <tr>
            <td>@{{ report.reporterName }}</td>
            <td>@{{ report.reportedName }}</td>
            <td>{{ report.description }}</td>
            <td>{{ report.createAt| date }}</td>
            <td>
              <button class="btn btn-sm btn-outline-danger me-2" (click)="deleteReport(report)">Delete
                Report</button>
              <button class="btn btn-sm btn-outline-primary" (click)="goToPost(report.postId)">Visit Post</button>
            </td>
          </tr>
          }
        </tbody>
      </table>

      <div class="d-flex justify-content-between align-items-center">
        <button class="btn btn-outline-primary btn-sm" (click)="prevPostReportsPage()"
          [disabled]="postReportsPage === 0">Previous</button>
        <span>Page {{ postReportsPage + 1 }}</span>
        <button class="btn btn-outline-primary btn-sm" (click)="nextPostReportsPage()"
          [disabled]="!hasMorePostReports">Next</button>
      </div>
    </div>
  </div>
  }
</div>