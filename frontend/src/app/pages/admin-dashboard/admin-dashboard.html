<app-navbar-component></app-navbar-component>

<div class="container my-4">

  <div class="row g-3 mb-4">
    @for (card of [
    { title: 'Total Users', value: totalUsers, icon: UserIcon, color: 'success' },
    { title: 'User Reports', value: totalUserReports, icon: FlagIcon, color: 'warning' },
    { title: 'Total Posts', value: totalPosts, icon: FileTextIcon, color: 'primary' },
    { title: 'Total Banned', value: totalBan, icon: BannedIcon, color: 'danger' },
    { title: 'Post Reports', value: totalPostReport, icon: FlagIcon, color: 'info' }
    ]; track card.title) {
    <div class="col-12 col-md-4">
      <div class="card shadow-sm border-light h-100">
        <div class="card-body d-flex align-items-center">
          <div class="icon-container text-{{ card.color }} me-3">
            <lucide-icon [img]="card.icon"></lucide-icon>
          </div>
          <div>
            <h6 class="text-muted mb-1">{{ card.title }}</h6>
            <h3 class="fw-bold mb-0">{{ card.value }}</h3>
          </div>
        </div>
      </div>
    </div>
    }
  </div>

  <ul class="nav nav-tabs mb-3 flex-wrap">
    <li class="nav-item">
      <button class="nav-link" [ngClass]="{ active: activeTab === 'users' }" (click)="setTab('users')">Users</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" [ngClass]="{ active: activeTab === 'bannedUsers' }"
        (click)="setTab('bannedUsers')">Banned Users</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" [ngClass]="{ active: activeTab === 'userReports' }" (click)="setTab('userReports')">User
        Reports</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" [ngClass]="{ active: activeTab === 'posts' }" (click)="setTab('posts')">Posts</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" [ngClass]="{ active: activeTab === 'postReports' }" (click)="setTab('postReports')">Post
        Reports</button>
    </li>
  </ul>

  @if (isLoading) {
  <div class="text-center my-4">
    <div class="spinner-border text-primary" role="status"></div>
  </div>
  }

   @if (!isLoading && activeTab === 'bannedUsers') {
  <div class="card shadow-sm border-light">
    <div class="card-body">
      <h5 class="mb-3">Banned Users</h5>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Avatar</th>
              <th>Username</th>
              <th>Email</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (user of bannedUsers; track user.id) {
            <tr>
              <td><img [src]="user.iconPath || 'assets/default-avatar.png'" width="40" height="40"
                  class="rounded-circle" /></td>
              <td><strong (click)="goToUser(user.id)" class="clickable">@{{ user.username }}</strong></td>
              <td>{{ user.email }}</td>
              <td>
                <button class="btn btn-sm btn-outline-success" (click)="toggleBan(user)">Unban</button>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      <div class="d-flex justify-content-between align-items-center mt-3">
        <button class="btn btn-outline-primary btn-sm" (click)="prevBannedUsersPage()"
          [disabled]="bannedUsersPage === 0">Previous</button>
        <span>Page {{ bannedUsersPage + 1 }}</span>
        <button class="btn btn-outline-primary btn-sm" (click)="nextBannedUsersPage()"
          [disabled]="!hasMoreBannedUsers">Next</button>
      </div>
    </div>
  </div>
  }

  @if (!isLoading && activeTab === 'users') {
  <div class="card shadow-sm border-light">
    <div class="card-body">
      <h5 class="mb-3">User Management</h5>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Avatar</th>
              <th>Username</th>
              <th>Email</th>
              <th>Status</th>
              <th>Joined</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (user of users; track user.id) {
            <tr>
              <td><img [src]="user.iconPath || 'assets/default-avatar.png'" width="40" height="40"
                  class="rounded-circle" /></td>
              <td><strong (click)="goToUser(user.id)" class="clickable">@{{ user.username }}</strong></td>
              <td>{{ user.email }}</td>
              <td><span class="badge" [ngClass]="user.isBanned ? 'bg-danger' : 'bg-success'">{{ user.isBanned ? 'Banned'
                  : 'Active' }}</span></td>
              <td>{{ user.createdAt | date }}</td>
              <td>
                <button class="btn btn-sm btn-outline-warning me-2" (click)="toggleBan(user)">
                  {{ user.isBanned ? 'Unban' : 'Ban' }}
                </button>
                <button class="btn btn-sm btn-outline-danger" (click)="deleteUser(user)">Delete</button>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-content-between align-items-center mt-3">
        <button class="btn btn-outline-primary btn-sm" (click)="prevUsersPage()"
          [disabled]="pageUsers === 0">Previous</button>
        <span>Page {{ pageUsers + 1 }}</span>
        <button class="btn btn-outline-primary btn-sm" (click)="nextUsersPage()"
          [disabled]="!hasMoreUsers">Next</button>
      </div>
    </div>
  </div>
  }

  @if (!isLoading && activeTab === 'userReports') {
  <div class="card shadow-sm border-light">
    <div class="card-body">
      <h5 class="mb-3">User Reports</h5>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Reporter</th>
              <th>Reported</th>
              <th>Description</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (report of userReports; track report.id) {
            <tr>
              <td (click)="goToUser(report.reporterId)" class="clickable">@{{ report.reporterName }}</td>
              <td (click)="goToUser(report.reportedId)" class="clickable">@{{ report.reportedName }}</td>
              <td class="desc-col">{{ report.description }}</td>
              <td>{{ report.createAt | date }}</td>
              <td>
                <button class="btn btn-sm btn-outline-danger" (click)="deleteUserReport(report)">Delete Report</button>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-content-between align-items-center mt-3">
        <button class="btn btn-outline-primary btn-sm" (click)="prevUserReportsPage()"
          [disabled]="userReportsPage === 0">Previous</button>
        <span>Page {{ userReportsPage + 1 }}</span>
        <button class="btn btn-outline-primary btn-sm" (click)="nextUserReportsPage()"
          [disabled]="!hasMoreUserReports">Next</button>
      </div>
    </div>
  </div>
  }

  @if (!isLoading && activeTab === 'posts') {
  <div class="card shadow-sm border-light">
    <div class="card-body">
      <h5 class="mb-3">Posts</h5>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Title</th>
              <th>Author</th>
              <th>Likes</th>
              <th>Created</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (post of posts; track post.id) {
            <tr>
              <td (click)="goToPost(post.id)" class="clickable" [title]="post.title">
                {{ post.title.length > 20 ? (post.title | slice:0:20) + '...' : post.title }}
              </td>
              <td>@{{ post.authorName }}</td>
              <td>{{ post.likes }}</td>
              <td>{{ post.createdAt | date }}</td>
              <td><span class="badge" [ngClass]="post.isHide ? 'bg-secondary' : 'bg-success'">{{ post.isHide ? 'Hidden'
                  : 'Visible' }}</span></td>
              <td>
                <button class="btn btn-sm btn-outline-secondary me-2" (click)="hidePost(post)">
                  {{ post.isHide ? 'Unhide' : 'Hide' }}
                </button>
                <button class="btn btn-sm btn-outline-danger" (click)="deletePost(post)">Delete</button>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-content-between align-items-center mt-3">
        <button class="btn btn-outline-primary btn-sm" (click)="prevPostsPage()"
          [disabled]="pagePosts === 0">Previous</button>
        <span>Page {{ pagePosts + 1 }}</span>
        <button class="btn btn-outline-primary btn-sm" (click)="nextPostsPage()"
          [disabled]="!hasMorePosts">Next</button>
      </div>
    </div>
  </div>
  }

  @if (!isLoading && activeTab === 'postReports') {
  <div class="card shadow-sm border-light">
    <div class="card-body">
      <h5 class="mb-3">Post Reports</h5>
      <div class="table-responsive">
        <table class="table table-hover align-middle fixed-table mb-0">
          <thead class="table-light">
            <tr>
              <th>Reporter</th>
              <th>Reported</th>
              <th class="desc-col">Description</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (report of postReports; track report.id) {
            <tr>
              <td (click)="goToUser(report.reporterId)" class="clickable">@{{ report.reporterName }}</td>
              <td (click)="goToUser(report.reportedId)">@{{ report.reportedName }}</td>
              <td class="desc-col">{{ report.description }}</td>
              <td>{{ report.createAt | date }}</td>
              <td class="action-col">
                <button class="btn btn-sm btn-outline-danger me-2" (click)="deletePostReport(report)">Delete Report</button>
                <button class="btn btn-sm btn-outline-primary" (click)="goToPost(report.postId)">Visit Post</button>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-content-between align-items-center mt-3">
        <button class="btn btn-outline-primary btn-sm" (click)="prevPostReportsPage()"
          [disabled]="postReportsPage === 0">Previous</button>
        <span>Page {{ postReportsPage + 1 }}</span>
        <button class="btn btn-outline-primary btn-sm" (click)="nextPostReportsPage()"
          [disabled]="!hasMorePostReports">Next</button>
      </div>
    </div>
  </div>
  }

</div>

@if (showConfirmModal) {
<div class="modal-backdrop fade show" (click)="closeModal()"></div>
<div class="modal fade show d-block" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow">
      <div class="modal-header">
        <h5 class="modal-title">Confirm Action</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to perform this action?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="confirmAction()">Confirm</button>
      </div>
    </div>
  </div>
</div>
}