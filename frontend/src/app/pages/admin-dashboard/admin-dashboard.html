<app-navbar-component></app-navbar-component>

<div class="container my-4">

  <!-- Dashboard Summary -->
  <div class="row g-3 mb-4">
    @for (card of [
    { title: 'Total Users', value: totalUsers, icon: UserIcon, color: 'success' },
    { title: 'User Reports', value: totalUserReports, icon: FlagIcon, color: 'warning' },
    { title: 'Total Posts', value: totalPosts, icon: FileTextIcon, color: 'primary' }
    ]; track card.title) {
    <div class="col-12 col-md-4">
      <div class="card shadow-sm border-light h-100">
        <div class="card-body d-flex align-items-center">
          <div class="icon-container text-{{ card.color }} me-3">
            <lucide-icon [img]="card.icon"></lucide-icon>
          </div>
          <div>
            <h6 class="text-muted mb-1">{{ card.title }}</h6>
            <h3 class="fw-bold mb-0">{{ card.value }}</h3>
          </div>
        </div>
      </div>
    </div>
    }
  </div>

  <!-- Tabs -->
  <ul class="nav nav-tabs mb-3 flex-wrap">
    <li class="nav-item">
      <button class="nav-link" [ngClass]="{ active: activeTab === 'users' }" (click)="setTab('users')">Users</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" [ngClass]="{ active: activeTab === 'userReports' }" (click)="setTab('userReports')">User
        Reports</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" [ngClass]="{ active: activeTab === 'posts' }" (click)="setTab('posts')">Posts</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" [ngClass]="{ active: activeTab === 'postReports' }" (click)="setTab('postReports')">Post
        Reports</button>
    </li>
  </ul>

  <!-- Loading -->
  @if (isLoading) {
  <div class="text-center my-4">
    <div class="spinner-border text-primary" role="status"></div>
  </div>
  }

  <!-- USERS TAB -->
  @if (!isLoading && activeTab === 'users') {
  <div class="card shadow-sm border-light">
    <div class="card-body">
      <h5 class="mb-3">User Management</h5>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Avatar</th>
              <th>Username</th>
              <th>Email</th>
              <th>Status</th>
              <th>Joined</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (user of users; track user.id) {
            <tr>
              <td><img [src]="user.iconPath || 'assets/default-avatar.png'" width="40" height="40"
                  class="rounded-circle" /></td>
              <td><strong (click)="goToUser(user.id)" class="clickable">@{{ user.username }}</strong></td>
              <td>{{ user.email }}</td>
              <td><span class="badge" [ngClass]="user.isBanned ? 'bg-danger' : 'bg-success'">{{ user.isBanned ? 'Banned'
                  : 'Active' }}</span></td>
              <td>{{ user.createdAt | date }}</td>
              <td>
                <button class="btn btn-sm btn-outline-warning me-2" (click)="toggleBan(user)">
                  {{ user.isBanned ? 'Unban' : 'Ban' }}
                </button>
                <button class="btn btn-sm btn-outline-danger" (click)="deleteUser(user)">Delete</button>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-content-between align-items-center mt-3">
        <button class="btn btn-outline-primary btn-sm" (click)="prevUsersPage()"
          [disabled]="pageUsers === 0">Previous</button>
        <span>Page {{ pageUsers + 1 }}</span>
        <button class="btn btn-outline-primary btn-sm" (click)="nextUsersPage()"
          [disabled]="!hasMoreUsers">Next</button>
      </div>
    </div>
  </div>
  }

  <!-- REPORTS TAB -->
  @if (!isLoading && activeTab === 'userReports') {
  <div class="card shadow-sm border-light">
    <div class="card-body">
      <h5 class="mb-3">User Reports</h5>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Reporter</th>
              <th>Reported</th>
              <th>Description</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (report of userReports; track report.id) {
            <tr>
              <td (click)="goToUser(report.reporterId)" class="clickable">@{{ report.reporterName }}</td>
              <td (click)="goToUser(report.reportedId)" class="clickable">@{{ report.reportedName }}</td>
              <td class="desc-col">{{ report.description }}</td>
              <td>{{ report.createAt | date }}</td>
              <td>
                <button class="btn btn-sm btn-outline-danger" (click)="deleteReport(report)">Delete Report</button>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-content-between align-items-center mt-3">
        <button class="btn btn-outline-primary btn-sm" (click)="prevUserReportsPage()"
          [disabled]="userReportsPage === 0">Previous</button>
        <span>Page {{ userReportsPage + 1 }}</span>
        <button class="btn btn-outline-primary btn-sm" (click)="nextUserReportsPage()"
          [disabled]="!hasMoreUserReports">Next</button>
      </div>
    </div>
  </div>
  }

  <!-- POSTS TAB -->
  @if (!isLoading && activeTab === 'posts') {
  <div class="card shadow-sm border-light">
    <div class="card-body">
      <h5 class="mb-3">Posts</h5>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Title</th>
              <th>Author</th>
              <th>Likes</th>
              <th>Created</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (post of posts; track post.id) {
            <tr>
              <td (click)="goToPost(post.id)" class="clickable" [title]="post.title">
                {{ post.title.length > 20 ? (post.title | slice:0:20) + '...' : post.title }}
              </td>
              <td>@{{ post.authorName }}</td>
              <td>{{ post.likes }}</td>
              <td>{{ post.createdAt | date }}</td>
              <td><span class="badge" [ngClass]="post.isHide ? 'bg-secondary' : 'bg-success'">{{ post.isHide ? 'Hidden'
                  : 'Visible' }}</span></td>
              <td>
                <button class="btn btn-sm btn-outline-secondary me-2" (click)="hidePost(post)">
                  {{ post.isHide ? 'Unhide' : 'Hide' }}
                </button>
                <button class="btn btn-sm btn-outline-danger" (click)="deletePost(post)">Delete</button>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-content-between align-items-center mt-3">
        <button class="btn btn-outline-primary btn-sm" (click)="prevPostsPage()"
          [disabled]="pagePosts === 0">Previous</button>
        <span>Page {{ pagePosts + 1 }}</span>
        <button class="btn btn-outline-primary btn-sm" (click)="nextPostsPage()"
          [disabled]="!hasMorePosts">Next</button>
      </div>
    </div>
  </div>
  }

  <!-- POST REPORTS TAB -->
  @if (!isLoading && activeTab === 'postReports') {
  <div class="card shadow-sm border-light">
    <div class="card-body">
      <h5 class="mb-3">Post Reports</h5>
      <div class="table-responsive">
        <table class="table table-hover align-middle fixed-table mb-0">
          <thead class="table-light">
            <tr>
              <th>Reporter</th>
              <th>Reported</th>
              <th class="desc-col">Description</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (report of postReports; track report.id) {
            <tr>
              <td>@{{ report.reporterName }}</td>
              <td>@{{ report.reportedName }}</td>
              <td class="desc-col">{{ report.description }}</td>
              <td>{{ report.createAt | date }}</td>
              <td class="action-col">
                <button class="btn btn-sm btn-outline-danger me-2" (click)="deleteReport(report)">Delete Report</button>
                <button class="btn btn-sm btn-outline-primary" (click)="goToPost(report.postId)">Visit Post</button>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-content-between align-items-center mt-3">
        <button class="btn btn-outline-primary btn-sm" (click)="prevPostReportsPage()"
          [disabled]="postReportsPage === 0">Previous</button>
        <span>Page {{ postReportsPage + 1 }}</span>
        <button class="btn btn-outline-primary btn-sm" (click)="nextPostReportsPage()"
          [disabled]="!hasMorePostReports">Next</button>
      </div>
    </div>
  </div>
  }

</div>

<!-- Lucid icons definitions -->
<svg style="display:none;">
  <symbol id="icon-users" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <path d="M17 21v-2a4 4 0 0 0-3-3.87"></path>
    <path d="M7 21v-2a4 4 0 0 1 3-3.87"></path>
    <circle cx="12" cy="7" r="4"></circle>
  </symbol>
  <symbol id="icon-flag" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
    <line x1="4" y1="22" x2="4" y2="15"></line>
  </symbol>
  <symbol id="icon-file-text" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
    <polyline points="14 2 14 8 20 8"></polyline>
    <line x1="16" y1="13" x2="8" y2="13"></line>
    <line x1="16" y1="17" x2="8" y2="17"></line>
    <line x1="10" y1="9" x2="9" y2="9"></line>
  </symbol>
</svg>